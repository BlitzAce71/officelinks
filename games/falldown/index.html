<!DOCTYPE html>
<html>
<body>
<canvas id="gameCanvas" width="480" height="320"></canvas>
<script>
// Ball object
let Ball = function() {
    this.radius = 10;
    this.dx = 5; // Increase this for faster horizontal movement
    this.x = game.canvas.width / 2;
    this.y = game.canvas.height / 2;
    this.dy = 1; // Downward speed
    this.maxDy = 3; // Max falling speed
    this.movingLeft = false; // Add this
    this.movingRight = false; // Add this
}

    Ball.prototype.moveLeft = function() {
    this.movingLeft = true;
}

Ball.prototype.moveRight = function() {
    this.movingRight = true;
}

Ball.prototype.stopMovingLeft = function() {
    this.movingLeft = false;
}

Ball.prototype.stopMovingRight = function() {
    this.movingRight = false;
}
    // Platform object
    let Platform = function(y) {
        this.height = 10;
        this.width = Math.random() * (game.canvas.width / 2) + 50;
        this.x = Math.random() * (game.canvas.width - this.width);
        this.y = y;
    }

    // Game object
    let Game = function() {
        this.canvas = document.getElementById('gameCanvas');
        this.ctx = this.canvas.getContext('2d');
        this.ball = null;
        this.platforms = [];
        this.score = 0;
        this.speed = 2;
        this.maxSpeed = 6;
        this.spawnInterval = 120; // Platforms spawn every 120 frames initially
        this.counter = this.spawnInterval;
    }

    // Initialize game
    Game.prototype.start = function() {
        this.ball = new Ball();
    }

    // Game functions
    Game.prototype.draw = function() {
        // Clear screen
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        
        // Draw ball
        this.ctx.beginPath();
        this.ctx.arc(this.ball.x, this.ball.y, this.ball.radius, 0, Math.PI*2);
        this.ctx.fillStyle = "#0095DD";
        this.ctx.fill();
        this.ctx.closePath();

        // Draw platforms
        for (let i = 0; i < this.platforms.length; i++) {
            this.ctx.fillStyle = "#0095DD";
            this.ctx.fillRect(this.platforms[i].x, this.platforms[i].y, this.platforms[i].width, this.platforms[i].height);
        }

        // Draw score
        this.ctx.font = "16px Arial";
        this.ctx.fillStyle = "#0095DD";
        this.ctx.fillText("Score: "+this.score, 8, 20);
    }

    Game.prototype.update = function() {
    // Update ball position
    if (this.ball.movingLeft) {
        this.ball.x -= this.ball.dx;
        if (this.ball.x - this.ball.radius < 0) {
            this.ball.x = this.ball.radius;
        }
    }
    if (this.ball.movingRight) {
        this.ball.x += this.ball.dx;
        if (this.ball.x + this.ball.radius > this.canvas.width) {
            this.ball.x = this.canvas.width - this.ball.radius;
        }
    }
		this.ball.y += this.ball.dy;
        if (this.ball.y + this.ball.dy > this.canvas.height - this.ball.radius) {
            this.ball.y = this.canvas.height - this.ball.radius;
            this.ball.dy = 0;
        } else if (this.ball.dy < this.ball.maxDy) {
            this.ball.dy += 0.1; // Accelerate downwards
        }

        // Update platform positions and remove off-screen platforms
        for (let i = 0; i < this.platforms.length; i++) {
            this.platforms[i].y -= this.speed;
            if (this.platforms[i].y + this.platforms[i].height < 0) {
                this.platforms.splice(i, 1);
                this.score++;
                this.speed = Math.min(this.maxSpeed, this.speed + 0.1); // Increase speed up to maxSpeed
                this.spawnInterval = Math.max(30, this.spawnInterval - 2); // Decrease spawnInterval down to 30 frames
            }
        }

        // Collisions with platforms
        for (let i = 0; i < this.platforms.length; i++) {
            let plat = this.platforms[i];
            if (this.ball.y + this.ball.radius > plat.y && this.ball.y - this.ball.radius < plat.y + plat.height &&
                this.ball.x + this.ball.radius > plat.x && this.ball.x - this.ball.radius < plat.x + plat.width) {
                this.ball.dy = 0; // Stop falling when hitting a platform
                this.ball.y = plat.y - this.ball.radius; // Move ball on top of platform
            }
        }

        // Spawn new platforms
        this.counter--;
        if (this.counter <= 0) {
            this.platforms.push(new Platform(this.canvas.height));
            this.counter = this.spawnInterval;
        }

        // Game over
        if (this.ball.y <= this.ball.radius) {
            alert("GAME OVER!\nScore: " + this.score);
            document.location.reload();
            clearInterval(interval); // Needed for Chrome to end game
        }
    }

    let game = new Game();
    game.start();
    let interval = setInterval(function(){ game.draw(); game.update(); }, 10);
    
    document.addEventListener('keydown', function(event) {
    switch(event.key) {
        case "ArrowLeft":
            game.ball.moveLeft();
            break;
        case "ArrowRight":
            game.ball.moveRight();
            break;
    }
});

document.addEventListener('keyup', function(event) {
    switch(event.key) {
        case "ArrowLeft":
            game.ball.stopMovingLeft();
            break;
        case "ArrowRight":
            game.ball.stopMovingRight();
            break;
    }
});
</script>
</body>
</html>
